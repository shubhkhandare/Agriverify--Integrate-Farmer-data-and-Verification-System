-- 1. FARMER Table
DROP TABLE FARMER;

CREATE TABLE FARMER (
    FARMER_ID NUMBER CONSTRAINT FARMER_ID_PK PRIMARY KEY,
    FIRST_NAME  VARCHAR2(50) NOT NULL,
    LAST_NAME  VARCHAR2(50) NOT NULL,
    DOB  DATE,
    GENDER  VARCHAR2(10) CHECK (GENDER IN ('Male','Female','Other')),
    ADHAR_NUMBER  VARCHAR2(12) NOT NULL UNIQUE,
    CONTACT_NUMBER VARCHAR2(10) NOT NULL UNIQUE
);

-- 2. ADDRESS Table
CREATE TABLE ADDRESS (
    ADDRESS_ID NUMBER CONSTRAINT ADDRESS_ID_PK PRIMARY KEY,
    FARMER_ID NUMBER NOT NULL,
    STREET_NAME  VARCHAR2(100) NOT NULL,
    VILLAGE  VARCHAR2(50) NOT NULL,
    SUB_DISTRICT VARCHAR2(50) NOT NULL,
    DISTRICT   VARCHAR2(50),
    STATE  VARCHAR2(50) NOT NULL,
    PIN_CODE  NUMBER(6) NOT NULL,

    CONSTRAINT ADDRESS_FARMER_ID_FK FOREIGN KEY (FARMER_ID)
    REFERENCES FARMER(FARMER_ID)
    ON DELETE CASCADE
);

-- 3. DOCUMENT Table
CREATE TABLE DOCUMENT (
    DOCUMENT_ID NUMBER CONSTRAINT DOCUMENT_ID_PK PRIMARY KEY,
    FARMER_ID   NUMBER NOT NULL,
    DOCUMENT_TYPE VARCHAR2(50) NOT NULL,
    DOCUMENT_NUMBER VARCHAR2(50),
    DESCRIPTION   VARCHAR2(200),
    
    CONSTRAINT DOCUMENT_FARMER_ID_FK FOREIGN KEY (FARMER_ID)
    REFERENCES FARMER(FARMER_ID)
    ON DELETE CASCADE
);

-- 4. LAND Table
CREATE TABLE LAND (
    LAND_ID  NUMBER CONSTRAINT LAND_ID_PK PRIMARY KEY,
    FARMER_ID  NUMBER NOT NULL,
    GAT_NUMBER  VARCHAR2(20) ,
    KHATE_NUMBER  VARCHAR2(20),     
    SOIL_TYPE  VARCHAR2(50),
    LAND_AREA NUMBER(4,2) NOT NULL, -- in acres
    DESCRIPTION   VARCHAR2(200),
    CONSTRAINT LAND_FARMER_ID_FK FOREIGN KEY (FARMER_ID)
    REFERENCES FARMER(FARMER_ID)
    ON DELETE CASCADE
);

-- 5. FINANCIAL_DETAILS Table
ALTER TABLE FINANCIAL_DETAILS
MODIFY ACCOUNT_NUMBER VARCHAR2(15);

ALTER TABLE FINANCIAL_DETAILS
MODIFY IFSC_CODE VARCHAR2(11);

CREATE TABLE FINANCIAL_DETAILS (
    FINANCIAL_ID  NUMBER CONSTRAINT FINANCIAL_ID_PK PRIMARY KEY,
    FARMER_ID  NUMBER NOT NULL,
    ACCOUNT_NUMBER  NUMBER(20),
    BANK_NAME VARCHAR2(70),
    BRANCH_NAME VARCHAR2(40),
    IFSC_CODE NUMBER(11),
    CONSTRAINT FINANCIAL_FARMER_ID_FK FOREIGN KEY (FARMER_ID)
    REFERENCES FARMER(FARMER_ID)
    ON DELETE CASCADE
);

-- 6. LAND_CROP_ALLOCATION 
CREATE TABLE LAND_CROP_ALLOCATION (
    ALLOCATION_ID  NUMBER CONSTRAINT ALLOCATION_ID_PK PRIMARY KEY,
    LAND_ID NUMBER NOT NULL,
    CROP_ID NUMBER NOT NULL,
    AREA_ALLOCATED  NUMBER(4,2), --- in acres
    CULTIVATION_DATE DATE,
    HARVEST_DATE DATE,
    IRRIGATION_TYPE VARCHAR2(40) CHECK (IRRIGATION_TYPE IN ('Surface','Sprinkler','Drip')),

    CONSTRAINT LCA_LAND_ID_FK FOREIGN KEY (LAND_ID)
    REFERENCES LAND(LAND_ID)
    ON DELETE CASCADE,
    
    CONSTRAINT LCA_CROP_ID_FK FOREIGN KEY (CROP_ID)
    REFERENCES CROP(CROP_ID)
    ON DELETE SET NULL
);

-- 7. GOVERMENT_SCHEME
CREATE TABLE GOVERMENT_SCHEME (
    GOVERMENT_SCHEME_ID  NUMBER CONSTRAINT SCHEME_ID_PK PRIMARY KEY,
    FINANCIAL_ID  NUMBER NOT NULL,
    SCHEME_NAME  VARCHAR2(100) NOT NULL,
    START_DATE  DATE NOT NULL,
    END_DATE  DATE,
    STATUS VARCHAR2(20) CHECK (STATUS IN ('Active', 'Expired')),
    
    CONSTRAINT GOVSCHEMES_FINANCIAL_id_fk FOREIGN KEY (FINANCIAL_ID)
    REFERENCES FINANCIAL_DETAILS(FINANCIAL_ID)
    ON DELETE CASCADE
);

-- 8. LOAN Table
CREATE TABLE LOAN (
    LOAN_ID NUMBER CONSTRAINT LOAN_ID_PK PRIMARY KEY,
    FINANCIAL_ID NUMBER NOT NULL,
    LOAN_TYPE VARCHAR2(30),
    LOAN_STATUS  VARCHAR2(30) CHECK (LOAN_STATUS IN ('PAID','PENDING')),
    
    CONSTRAINT LOAN_FINANCIAL_ID_FK FOREIGN KEY (FINANCIAL_ID)
    REFERENCES FINANCIAL_DETAILS(FINANCIAL_ID)
    ON DELETE CASCADE
);

-- 9. CROP Table
CREATE TABLE CROP (
    CROP_ID  NUMBER CONSTRAINT CROP_ID_PK PRIMARY KEY,
    CROP_NAME VARCHAR2(50) NOT NULL,
    SEASON  VARCHAR2(20) CHECK (SEASON IN ('Kharif','Rabi','Summer')),
    DURATION VARCHAR2(10),
    DESCRIPTION VARCHAR2(200)
);

-- 10. CROP_INCOME
CREATE TABLE CROP_INCOME (
    CROP_INCOME_ID NUMBER CONSTRAINT HISTORY_ID_FK PRIMARY KEY,
    ALLOCATION_ID NUMBER NOT NULL,
    CULTIVATION_COST NUMBER,
    YIELD NUMBER(6,2), -- (in quintal)
    REVENUE NUMBER,
    DESCRIPTION VARCHAR2(100),
    
    CONSTRAINT CROP_INCOME_ALLOCATION_ID_FK FOREIGN KEY (ALLOCATION_ID)
    REFERENCES LAND_CROP_ALLOCATION(ALLOCATION_ID)
    ON DELETE CASCADE

);

-- 11. INSURANCE Table
CREATE TABLE INSURANCE (
    INSURANCE_ID NUMBER CONSTRAINT INSURANCE_ID_PK PRIMARY KEY,
    ALLOCATION_ID  NUMBER NOT NULL,
    INSURANCE_PROVIDER VARCHAR2(100),
    START_DATE DATE,
    END_DATE  DATE,
    STATUS VARCHAR2(20) CHECK (STATUS IN ('Active','Expired')),
    DESCRIPTION VARCHAR2(200),

    CONSTRAINT FK_INSURANCE_ALLOCATION FOREIGN KEY (ALLOCATION_ID)
    REFERENCES LAND_CROP_ALLOCATION(ALLOCATION_ID)
   ON DELETE CASCADE

);
